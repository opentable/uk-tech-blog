<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><meta name="author" content="OpenTable"><link rel="icon" href="/favicon.png"><title>OpenTable Tech UK Blog</title><meta name="description"><link rel="alternate" type="application/rss+xml" title="OpenTable Tech UK Blog" href="/atom.xml"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><script src="//fonts.otstatic.com/zys4lfz.js"></script><link rel="stylesheet" href="/css/highlight.css">
</head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class="container-fluid"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#main-navbar" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">OpenTable Tech UK Blog</a></div><div id="main-navbar" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/about/">About</a></li><li><a href="/archives/">Archive</a></li><li><a href="/blog/authors/">Authors</a></li></ul></div><div class="avatar-container"><div class="avatar-img-border"><a href="/"><img src="/opentable.png" class="avatar-img"></a></div></div></div></nav><div id="header-big-imgs" data-num-img='3' data-img-src-1="/bigimgs/building.jpg" data-img-desc-1="Alphabeta Building" data-img-src-2="/bigimgs/kitchen.jpg" data-img-desc-2="OpenTable London office" data-img-src-3="/bigimgs/office.jpg" data-img-desc-3="OpenTable Engineers"></div><header class="header-section has-img"><div class="intro-header big-img"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="page-heading"><h1>OpenTable Tech UK Blog</h1><hr class="small"><span class="page-subheading">The technology blog for OpenTable UK.</span></div></div></div></div><span class="img-desc"></span></div></header><div role="main" class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="posts-list"><article class="post-preview"><a href="/blog/2014/05/19/continuous-delivery-automating-deployment-visibility/"><h2 class="post-title">Continuous Delivery: Automating Deployment Visibility</h2></a><p class="post-meta">Posted on 19 May 2014 · <a href="/blog/categories/Continuous-delivery/" class="tag post-meta">Continuous delivery</a> · <a href="/blog/categories/Hubot/" class="tag post-meta">Hubot</a> · <a href="/blog/categories/Hipchat/" class="tag post-meta">Hipchat</a> · <a href="/blog/categories/Chatops/" class="tag post-meta">Chatops</a></p><div class="post-entry"><p>In our continued effort to drive towards a service oriented architecture each of our teams are continuously improving their deployment processes. Recently our team has focussed on automating as much as possible, putting as much into chat as we can and improving our logging/metrics.</p>
<p>The image below shows at a high level what our teams current deployment pipeline looks like and this post will attempt to summarise some recent changes that have allowed us to automate visibility.</p>
<img src="/images/posts/release-pipeline.png" width="900" height="350" title="image images">
<h2 id="Kicking-off-a-deployment"><a href="#Kicking-off-a-deployment" class="headerlink" title="Kicking off a deployment"></a>Kicking off a deployment</h2><p>I wrote previously that we started <a href="/blog/2013/11/22/beginning-a-journey-to-chatops-with-hubot/">using chatops</a> to increase visibility operationally. Hubot is central to this and we wrote a small script to kick off deployments within <a href="https://www.hipchat.com/" target="_blank" rel="external">Hipchat</a></p>
<img src="/images/posts/hubot-deploy-restaurant.png" width="350" height="350" title="image images"></div><a href="/blog/2014/05/19/continuous-delivery-automating-deployment-visibility/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/05/15/managing-windows-features-with-puppet/"><h2 class="post-title">Managing Windows Features with Puppet</h2></a><p class="post-meta">Posted on 15 May 2014 · <a href="/blog/categories/Puppet/" class="tag post-meta">Puppet</a> · <a href="/blog/categories/PowerShell/" class="tag post-meta">PowerShell</a> · <a href="/blog/categories/DevOps/" class="tag post-meta">DevOps</a> · <a href="/blog/categories/Configuration-Management/" class="tag post-meta">Configuration Management</a> · <a href="/blog/categories/Windows/" class="tag post-meta">Windows</a> · <a href="/blog/categories/WindowsFeature/" class="tag post-meta">WindowsFeature</a></p><div class="post-entry"><p>Back in June 2013, I wrote about <a href="/blog/2013/06/14/windows-feature-management-with-powershell/">Windows Feature Management with PowerShell</a>. We have since released a Puppet module that will do this for us. We originally wrote PowerShell:</p>
<pre><code>Import-Module ServerManager
Add-WindowsFeature Web-Asp-Net
</code></pre><p>The Puppet module now wraps this code as follows:</p>
<pre><code>windowsfeature { &apos;Web-Asp-Net&apos;: }
</code></pre><p>The declaration windowsfeature is a specific Puppet type called a <a href="http://docs.puppetlabs.com/learning/definedtypes.html" target="_blank" rel="external">define</a>. In developer terms, this is the equivalent of a helper method that can be reused. We can also make sure that Windows Features are <em>not</em> installed on the server as follows:</p>
<pre><code>windowsfeature { &apos;Telnet-Server&apos;: 
  ensure =&gt; absent 
}
</code></pre></div><a href="/blog/2014/05/15/managing-windows-features-with-puppet/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/05/13/managing-windows-web-applications-with-puppet/"><h2 class="post-title">Managing Windows Web Applications with Puppet</h2></a><p class="post-meta">Posted on 13 May 2014 · <a href="/blog/categories/Puppet/" class="tag post-meta">Puppet</a> · <a href="/blog/categories/PowerShell/" class="tag post-meta">PowerShell</a> · <a href="/blog/categories/DevOps/" class="tag post-meta">DevOps</a> · <a href="/blog/categories/Configuration-Management/" class="tag post-meta">Configuration Management</a> · <a href="/blog/categories/Windows/" class="tag post-meta">Windows</a> · <a href="/blog/categories/IIS/" class="tag post-meta">IIS</a></p><div class="post-entry"><p>As part of our move towards a configuration management tool, we really wanted to start automating as much of our infrastructure as possible. This included our application configuration stack. IIS management is pretty easy with PowerShell. It would look something like this</p>
<pre><code>Import-Module WebAdministration
New-WebSite -Name &quot;DemoSite&quot; -Port 80 -IP * -PhysicalPath &quot;c:\inetpub\wwwroot&quot; -ApplicationPool &quot;MyAppPool&quot;
</code></pre><p>This would of course set up a website called ‘DemoSite’ running on port 80 on the local machine. The cmdlets that come with PowerShell make this pretty easy. This is great if it is a one-off job to set up a site. We run our websites from a number of webservers, therefore, it would be silly to have to RDP into each webserver and run a script on it. This is why tools like Puppet, Chef, Ansible etc. exist. We needed a configuration management tool to do this work for us. It has a number of benefits:</p>
<ul>
<li>Orchestration</li>
<li>Idempotency</li>
<li>Makes sure that each server is configured in ‘exactly’ the same way as no human intervention is needed</li>
<li>Developers can help the operations team by creating the scripts needed. This is great for collaboration between teams</li>
</ul>
<p>On investigating how we would do this with Puppet, we noticed that there were not many other people managing their site in this way. Therefore, we would have to turn our PowerShell scripts into Puppet modules to manage our system. </p>
<p>We have since created a Puppet module to manage IIS. To manage IIS with Puppet, we can now write the following code:</p></div><a href="/blog/2014/05/13/managing-windows-web-applications-with-puppet/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/04/29/remote-worker-notes-tools-and-setup/"><h2 class="post-title">Remote Worker Notes &ndash; Tools and Setup</h2></a><p class="post-meta">Posted on 29 April 2014 · <a href="/blog/categories/Work-smarter/" class="tag post-meta">Work smarter</a> · <a href="/blog/categories/Culture/" class="tag post-meta">Culture</a> · <a href="/blog/categories/Agile/" class="tag post-meta">Agile</a> · <a href="/blog/categories/Remote-working/" class="tag post-meta">Remote working</a></p><div class="post-entry"><p>For the last couple months I’ve been working remotely with our search team at OpenTable. Let me share our remote working setup and some rationale for our choices. I will shy away from judging how it’s all worked out and leave that for subsequent blog posts.</p>
<h2 id="The-deal"><a href="#The-deal" class="headerlink" title="The deal"></a>The deal</h2><p>I started as an on-site engineer and subsequently became a remote worker and my challenge was to make remote working as similar to on-site working as possible. Thus it is natural that <strong>I work the same working hours</strong> as my colleagues in the office (despite the time difference) and I take <strong>public holidays</strong> at the same time that there are bank holidays in UK (even though in Poland they are different).</p>
<p>We also decided that every two months I will <strong>visit the office for a week</strong> as well as arranging visits to coincide with other office guests (like contractors, overseas colleagues and so on). All this is to try to keep me as close to the team as possible and disrupt the normal work-flow as little as possible.</p>
<h2 id="The-workplace-setup"><a href="#The-workplace-setup" class="headerlink" title="The workplace setup"></a>The workplace setup</h2><p>Once home in Poland I had to carefully consider my options for a workplace. I tried three obvious possibilities:</p>
</div><a href="/blog/2014/04/29/remote-worker-notes-tools-and-setup/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/04/28/effective-prioritisation/"><h2 class="post-title">Effective prioritisation</h2></a><p class="post-meta">Posted on 28 April 2014 · <a href="/blog/categories/Leadership/" class="tag post-meta">Leadership</a> · <a href="/blog/categories/Coaching/" class="tag post-meta">Coaching</a> · <a href="/blog/categories/Work-smarter/" class="tag post-meta">Work smarter</a> · <a href="/blog/categories/Culture/" class="tag post-meta">Culture</a></p><div class="post-entry"><p>Prioritisation is a huge part of modern life.</p>
<p>No.</p>
<p>Prioritisation is an ESSENTIAL part of modern life.</p>
<p>I’m not talking solely about Agile here either. Yes we plan stories, yes we prioritise them to get them into the backlog but I’m aiming at a higher level. Life lessons that are useful to all of us.</p>
<p>How do we know what to do next? Perhaps you lean on your gut feeling to order your to-do list. Maybe it is real-time cost and budget implications that influence your priorities or does it come down to who shouts loudest?</p>
</div><a href="/blog/2014/04/28/effective-prioritisation/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/04/16/look-ma-no-unit-tests/"><h2 class="post-title">Look ma, no unit tests!</h2></a><p class="post-meta">Posted on 16 April 2014 · <a href="/blog/categories/Engineering/" class="tag post-meta">Engineering</a> · <a href="/blog/categories/Testing/" class="tag post-meta">Testing</a> · <a href="/blog/categories/Acceptance-tests/" class="tag post-meta">Acceptance tests</a> · <a href="/blog/categories/Innovation/" class="tag post-meta">Innovation</a></p><div class="post-entry"><p><em><strong>UPDATE:</strong> I’ve written a <a href="/blog/2014/05/19/acceptance-now">follow-up to this post</a> with a bit more detail into how we made acceptance-only testing work in practice.</em></p>
<p>At OpenTable we strive to deliver change as quickly and correctly as possible. To do this effectively we are always looking for <a href="/blog/2014/02/28/api-benchmark/">new</a> <a href="/blog/2013/08/16/grunt-plus-vagrant-equals-acceptance-test-heaven/">tools</a> <a href="/blog/2014/04/07/upgrading-puppet-with-puppet/">and</a> <a href="/blog/2014/02/10/the-adoption-of-configuration-management/">methods</a> that allow us, the developers, to respond quickly and accurately to changing requirements and environments.</p>
<p>There are a number of practices that we already make use of, helping us to be the most effective team I’ve ever worked in:</p>
<ul>
<li>We operate in small teams who each own <em>most</em> of their own vertical.</li>
<li>We use continuous delivery to ship code to production within minutes.</li>
<li>We have a high degree of high-quality test coverage.</li>
<li>We are getting better and better at monitoring All The Things.</li>
<li><a href="/blog/2013/11/22/beginning-a-journey-to-chatops-with-hubot/">We use Chatops</a>, so communication is central to our work, and keeps remote workers/teams in the loop.</li>
</ul>
<p>All of the above are truly empowering for the dev team, and are conducive to an amazingly stress-free working environment. However, these practices only address the infrastructure, culture, and ceremony surrounding our work. What if there was something else? Something about the way we write the code itself, that could increase our velocity yet further, without compromising our integrity…</p>
</div><a href="/blog/2014/04/16/look-ma-no-unit-tests/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/04/07/upgrading-puppet-with-puppet/"><h2 class="post-title">Upgrading Puppet with Puppet</h2></a><p class="post-meta">Posted on 7 April 2014 · <a href="/blog/categories/Puppet/" class="tag post-meta">Puppet</a> · <a href="/blog/categories/Windows/" class="tag post-meta">Windows</a> · <a href="/blog/categories/Maintenance/" class="tag post-meta">Maintenance</a> · <a href="/blog/categories/Puppetversion/" class="tag post-meta">Puppetversion</a></p><div class="post-entry"><p>As part of one of our recent <a href="/blog/2014/04/04/forgefriday-our-commitment-to-the-puppet-forge/">ForgeFriday</a> efforts we released a new module puppetversion with the purpose of managing the installation and upgrade of Puppet in a platform agnostic way.</p>
<p>This should be a very straightforward task to complete because this is one of the core resources that Puppet manages - the upgrading of packages. With that in mind, putting <code>package { ‘puppet’: ensure =&gt; $version }</code> in one of our base profiles would be all that was needed but alas it was not. In this blog I want to take you through the history, the bugs, the platforms and the edge-cases that make performing an in-place upgrade of Puppet a more complex task that it ought to be.</p>
<h2 id="Debian"><a href="#Debian" class="headerlink" title="Debian"></a>Debian</h2><p>Like many, Ubuntu is our Debian derivative of choice for much of our newer production infrastructure. Debian, has the apt package management system and PuppetLabs provide the required deb packages as well as hosting their own apt repository to point our systems to. The main point of package management systems is that they take care of the dependency hell and the awkward upgrade paths all from within the confines of the package itself, and that is what happens with the PuppetLabs packages - great. </p>
<p>The problem that we had in some of our systems was that they had been built without the PuppetLabs apt repository. This means that they picked up a slightly older version of the Puppet packages from the main Ubuntu distribution repositories and didn’t have access to the newer versions of the Puppet packages. Ok, so we solved that with the following code:</p>
<pre><code>exec { &apos;rm_duplicate_puppet_source&apos;:
  path    =&gt; &apos;/usr/local/bin:/bin:/usr/bin&apos;,
  command =&gt; &apos;sed -i \&apos;s:deb\ http\:\/\/apt.puppetlabs.com\/ precise main::\&apos; /etc/apt/sources.list&apos;,
  onlyif  =&gt; &apos;grep \&apos;deb http://apt.puppetlabs.com/ precise main\&apos; /etc/apt/sources.list&apos;,
}

apt::source { &apos;puppetlabs&apos;:
  location    =&gt; &apos;http://apt.puppetlabs.com&apos;,
  repos       =&gt; &apos;main dependencies&apos;,
  key         =&gt; &apos;4BD6EC30&apos;,
  key_content =&gt; template(&apos;puppetversion/puppetlabs.gpg&apos;),
  require     =&gt; Exec[&apos;rm_duplicate_puppet_source&apos;]
}
</code></pre></div><a href="/blog/2014/04/07/upgrading-puppet-with-puppet/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/04/04/testing-puppet-with-beaker/"><h2 class="post-title">Testing Puppet with Beaker</h2></a><p class="post-meta">Posted on 4 April 2014</p><div class="post-entry"><p>One afternoon I got asked to write a new Puppet module to manage local users on our Linux boxes. Not a contrived example but a real-world need as we begin to move our infrastructure from Windows to Linux. Managing users is one of those tasks that is at the core of the Puppet ecosystem and I thought this would be pretty easy as I had done this sort of thing many times before. What added to the complexity was that we needed to support Ubuntu, Centos and FreeBSD machines that we had in our stack and we wanted to make it something that was open source and on the Forge - so lots of testing was required.</p>
<p>This was not the first module that I had written for the Forge but it was the first that I had written since PuppetLabs had introduced their new acceptance testing framework <a href="https://github.com/puppetlabs/beaker" target="_blank" rel="external">Beaker</a> and so I wanted to spend some time getting the module working with this new tool.</p>
<h2 id="Beaker"><a href="#Beaker" class="headerlink" title="Beaker"></a>Beaker</h2><p>The purpose of Beaker is to allow you to write acceptance tests for your modules, that is to write some manifests that use your module and test them out on a virtual machine. Some of you may remember <a href="https://github.com/puppetlabs/rspec-system-puppet" target="_blank" rel="external">rspec-system-puppet</a> was previously used to accomplish this, well PuppetLabs has since deprecated that in favour of Beaker but the premise is very much the same.</p>
<p>Using rspec-puppet for unit testing your manifests really only goes so far. If you’re just using the standard Puppet resources then it pretty safe to assume that it does what it says on the tin (I mean PuppetLabs really test their stuff!) but as soon as you start doing things that are a little more complex, using exec statements, custom facts, custom functions or targeting multiple operating systems then you’re really going to want to make sure that once the catalogs compile that they are doing what they are meant to be doing and this is where your acceptance test suite will come in.</p>
<p>With Beaker you can spin up a virtual machine, install modules, apply a manifest and then test what really happened.</p></div><a href="/blog/2014/04/04/testing-puppet-with-beaker/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/04/04/forgefriday-our-commitment-to-the-puppet-forge/"><h2 class="post-title">ForgeFriday - our commitment to the Puppet Forge</h2></a><p class="post-meta">Posted on 4 April 2014 · <a href="/blog/categories/OSS/" class="tag post-meta">OSS</a> · <a href="/blog/categories/Puppet/" class="tag post-meta">Puppet</a> · <a href="/blog/categories/Open-souce/" class="tag post-meta">Open souce</a></p><div class="post-entry"><p>Those of you that read this blog on a regular basis will be aware that here at OpenTable we take our commitment to Open Source very seriously. As part of the infrastructure team at OpenTable we are begining a process of being open-first. That means that everything we write will be open-sourced unless it contains a significant amount of internal information but we will architect to limit this.</p>
<p>As part of that commitment we are trying to release all our Puppet configuration. The key to maintaining any good habit is to do little and often and with that in mind we wanted to let you know about ForgeFriday.</p>
<p>Every Friday we will be releasing our Puppet code onto the <a href="http://forge.puppetlabs.com/opentable" target="_blank" rel="external">PuppetLabs Forge</a> (until we run out of modules). That means all our Windows modules, all our forks, our experiments, our custom facts and functions - anything and everything will start rolling out on Fridays. </p>
<p>It’s not just forge and forget either, we will continue to support all of our modules and those that use them. We will blog about some of the bigger, more important ones and continue to engage with the community as much as possible. If you’re using our modules (even if you have no issues) then let us know - we’d love to hear from you.</p></div><a href="/blog/2014/04/04/forgefriday-our-commitment-to-the-puppet-forge/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/04/02/internationalisation-in-a-restful-world/"><h2 class="post-title">Internationalisation in a RESTful world</h2></a><p class="post-meta">Posted on 2 April 2014 · <a href="/blog/categories/REST/" class="tag post-meta">REST</a> · <a href="/blog/categories/API/" class="tag post-meta">API</a> · <a href="/blog/categories/i18n/" class="tag post-meta">i18n</a> · <a href="/blog/categories/Internationalisation/" class="tag post-meta">Internationalisation</a> · <a href="/blog/categories/http/" class="tag post-meta">http</a></p><div class="post-entry"><p>I18n is often a painful afterthought when serving content from a http-api. It can be taken for granted and tacked on using nasty query string values. But thankfully HTTP provides us with a solid gold opportunity. If you can look past the mire of content negotiation you can see the nuggets that lie inside.</p>
<p>The accept-language header is used by most browsers and allows websites to serve content in a language that the user can (hopefully) understand. When we expose content from an api (in most of our use cases, at least), this content eventually ends up in front of a human (in some shape or form). Having our service-service communication serve localised resources can be invaluable because it frees the clients from having to think about i18n of the resources being served from our api.</p>
<p>It is a simple part of the HTTP specification and is widely used and supported.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">GET /product/123</div><div class="line">Accept-Language: en-US</div></pre></td></tr></table></figure>
<p>The accept-language header is specifically designed to allow the server to provide a representation of the resource which approximates something the client can understand.</p>
</div><a href="/blog/2014/04/02/internationalisation-in-a-restful-world/" class="post-read-more">[Read More]</a></article></div><ul class="pager main-pager"><li class="previous"><a href="/page/3">← Newer Posts</a></li><li class="next"><a href="/page/5">Older Posts →</a></li></ul></div></div></div><footer><div class="container beautiful-jekyll-footer"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href="https://github.com/opentable" title="GitHub"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-github"></i></span></a></li><li><a href="https://twitter.com/opentabletechuk" title="Twitter"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-twitter"></i></span></a></li><li><a href="https://www.linkedin.com/company/12181" title="LinkedIn"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-linkedin"></i></span></a></li><li><a href="http://stackoverflow.com/jobs/companies/opentable" title="StackOverflow"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-stack-overflow"></i></span></a></li></ul><p class="copyright text-muted">© OpenTable • 2017 • <a href="mailto:undefined"></a>
</p><p class="theme-by text-muted">Theme by
<a href="https://github.com/twoyao/beautiful-hexo">beautiful-hexo</a></p></div></div></div></footer><script src="/js/jquery-1.11.2.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/main.js"></script><script src="/js/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
    a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-2621903-16', 'auto');
ga('send', 'pageview');</script></body></html>