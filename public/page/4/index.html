<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><meta name="author" content="OpenTable"><link rel="icon" href="/favicon.png"><title>OpenTable Tech UK Blog</title><meta name="description"><link rel="alternate" type="application/rss+xml" title="OpenTable Tech UK Blog" href="/atom.xml"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><script src="//fonts.otstatic.com/zys4lfz.js"></script><link rel="stylesheet" href="/css/highlight.css">
</head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class="container-fluid"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#main-navbar" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">OpenTable Tech UK Blog</a></div><div id="main-navbar" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/about/">About</a></li><li><a href="/archives/">Archive</a></li><li><a href="/blog/authors/">Authors</a></li></ul></div><div class="avatar-container"><div class="avatar-img-border"><a href="/"><img src="/opentable.png" class="avatar-img"></a></div></div></div></nav><div id="header-big-imgs" data-num-img='3' data-img-src-1="/bigimgs/building.jpg" data-img-desc-1="Alphabeta Building" data-img-src-2="/bigimgs/kitchen.jpg" data-img-desc-2="OpenTable London office" data-img-src-3="/bigimgs/office.jpg" data-img-desc-3="OpenTable Engineers"></div><header class="header-section has-img"><div class="intro-header big-img"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="page-heading"><h1>OpenTable Tech UK Blog</h1><hr class="small"><span class="page-subheading">The technology blog for OpenTable UK.</span></div></div></div></div><span class="img-desc"></span></div></header><div role="main" class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="posts-list"><article class="post-preview"><a href="/blog/2016/04/27/opencomponents-microservices-in-the-front-end-world/"><h2 class="post-title">OpenComponents - microservices in the front-end world</h2></a><p class="post-meta">Posted on 27 April 2016 · <a href="/blog/categories/SOA/" class="tag post-meta">SOA</a> · <a href="/blog/categories/Microservices/" class="tag post-meta">Microservices</a> · <a href="/blog/categories/Microsites/" class="tag post-meta">Microsites</a> · <a href="/blog/categories/OpenComponents/" class="tag post-meta">OpenComponents</a> · <a href="/blog/categories/OC/" class="tag post-meta">OC</a></p><div class="post-entry"><p>Many engineers work every day on opentable.com from our offices located in Europe, America, and Asia, pushing changes to production multiple times a day. Usually, this is very hard to achieve, in fact it took years for us to get to this point. <a href="/blog/2015/02/09/dismantling-the-monolith-microsites-at-opentable/">I described in a previous article</a> how we dismantled our monolith in favour of a Microsites architecture. Since the publication of that blog post we have been working on something I believe to be quite unique, called <strong>OpenComponents</strong>.</p>
<h3 id="Another-front-end-framework"><a href="#Another-front-end-framework" class="headerlink" title="Another front-end framework?"></a>Another front-end framework?</h3><p>OpenComponents is a system to facilitate code sharing, reduce dependencies, and easily approach new features and experiments from the back-end to the front-end. To achieve this, it is based on the concept of using services as interfaces - enabling pages to render partial content that is located, executed and deployed independently.</p>
<p>OpenComponents is not <em>another SPA JS framework</em>; it is a set of conventions, patterns and tools to develop and quickly deploy fragments of front-end. In this perspective, it plays nicely with any existing architecture and framework in terms of front-end and back-end. Its purpose is to <strong>serve as delivery mechanism for a more modularised end-result in the front-end</strong>.</p>
<p>OC is been in production for more than a year at OpenTable and it is <a href="https://github.com/opentable/oc" target="_blank" rel="noopener">fully open-sourced</a>.</p>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>OpenComponents involves two parts:</p>
<ul>
<li>The <strong>consumers</strong> are web pages that need fragments of HTML for rendering partial contents. Sometimes they need some content during server-side rendering, somethings when executing code in the browser.</li>
<li>The <strong>components</strong> are small units of isomorphic code mainly consisting of HTML, Javascript and CSS. They can optionally contain some logic, allowing a server-side Node.js closure to compose a model that is used to render the view. When rendered they are pieces of HTML, ready to be injected in any web page.</li>
</ul>
<p>The framework consists of three parts:</p>
<ul>
<li>The <strong>cli</strong> allows developers to create, develop, test, and publish components.</li>
<li>The <strong>library</strong> is where the components are stored after the publishing. When components depend on static resources (such as images, CSS files, etc.) these are stored, during packaging and publishing, in a publicly-exposed part of the library that serves as a CDN.</li>
<li>The <strong>registry</strong> is a REST API that is used to consume components. It is the entity that handles the traffic between the library and the consumers.</li>
</ul></div><a href="/blog/2016/04/27/opencomponents-microservices-in-the-front-end-world/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2016/01/07/react-testing/"><h2 class="post-title">Testing React Components</h2></a><p class="post-meta">Posted on 7 January 2016 · <a href="/blog/categories/Testing/" class="tag post-meta">Testing</a> · <a href="/blog/categories/JavaScript/" class="tag post-meta">JavaScript</a> · <a href="/blog/categories/React/" class="tag post-meta">React</a></p><div class="post-entry"><p>At OpenTable it’s becoming an increasingly popular trend to use <em><a href="https://facebook.github.io/react/" target="_blank" rel="noopener">React</a></em>.<br>One of the reasons for this is the ability for it  to server-side render whilst still<br>giving us the client side flexibility that we all crave!</p>
<p>We all know to have stable, reliable software you need to have well written tests. Facebook knows this and<br>provides the handy <em><a href="https://facebook.github.io/react/docs/test-utils.html" target="_blank" rel="noopener">Test Utilities</a></em> library to make<br>our lives easier.</p>
<p>Cool — I hear you all say! But what is the best approach to testing React components?</p>
<p>Well unfortunately this is something that is not very well documented and if not approached in<br>the correct way can lead to brittle tests.</p>
<p>Therefore I have written this blog post to discuss the different approaches we have available to us.</p>
<p>All code used in this post is avaliable on my <em><a href="https://github.com/chriscartlidge/React-Testing-Blog-Code" target="_blank" rel="noopener">GitHub</a></em>.</p>
<h2 id="The-Basics"><a href="#The-Basics" class="headerlink" title="The Basics"></a>The Basics</h2><p>To make our lives a lot easier when writing test it’s best to use a couple of basic tools. Below is<br>the absolute minimum required to start testing React components.</p>
<ul>
<li><em><a href="https://mochajs.org/" target="_blank" rel="noopener">Mocha</a></em> - This is a testing framework that runs in the browser or Node.JS (others are available).</li>
<li><em><a href="https://facebook.github.io/react/docs/test-utils.html" target="_blank" rel="noopener">ReactTestUtils</a></em> - This is the basic testing framework that Facebook provides to go testing with React.</li>
</ul>
<h2 id="The-Scenario"><a href="#The-Scenario" class="headerlink" title="The Scenario"></a>The Scenario</h2></div><a href="/blog/2016/01/07/react-testing/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2015/05/06/puppet-community/"><h2 class="post-title">Puppet-Community</h2></a><p class="post-meta">Posted on 6 May 2015 · <a href="/blog/categories/Puppet/" class="tag post-meta">Puppet</a> · <a href="/blog/categories/Puppet-community/" class="tag post-meta">Puppet-community</a></p><div class="post-entry"><p>Puppet is an important tool to us at OpenTable; we couldn’t operate as efficiently without it but Puppet is more than a tool or a vendor, it is a community of people trying to help<br>each other operate increasing complex and sophisticated infrastructures.</p>
<p>The Puppet community and the open source efforts that drive that community have always been important to us which is why we want to take a step further in our efforts and introduce<br>you to the “Puppet-community” project.</p>
<h2 id="What-is-Puppet-community"><a href="#What-is-Puppet-community" class="headerlink" title="What is Puppet-community"></a>What is Puppet-community</h2><p>Puppet-community is a GitHub organisation of like-minded individuals from across the wider Puppet ecosystem and from a diverse set of companies. Its principle aims are to allow the community to synchronise its efforts and to provide a GitHub organisation and Puppet Forge namespace not affiliated with any company.</p>
<p>Its wider aims are to provide a place for module and tool authors to share their code and the burden of maintaining it.</p>
<p>I would like to say that this was our idea, as it’s an excellent one, but actually all credit goes to its founders: <a href="https://github.com/igalic" target="_blank" rel="noopener">Igor Galić</a>, <a href="https://github.com/daenney" target="_blank" rel="noopener">Daniele Sluijters</a> and <a href="https://github.com/nibalizer" target="_blank" rel="noopener">Spencer Krum</a></p>
<h2 id="Why-communities-matter"><a href="#Why-communities-matter" class="headerlink" title="Why communities matter"></a>Why communities matter</h2><p>So why all the fuss about this? Why does it even matter where your code lives?</p>
<p>Well these are the some questions that I asked myself when I first heard about this project at PuppetConf 2014. The answer is that is really does matter and it’s a pattern that is<br>developing elsewhere (see: <a href="https://github.com/packer-community" target="_blank" rel="noopener">packer-community</a>, <a href="https://github.com/terraform-community-modules" target="_blank" rel="noopener">terraform-community-modules</a>,<br><a href="https://github.com/cloudfoundry-community" target="_blank" rel="noopener">cloudfoundry-community</a>) to deal with the problems you’ll face with a large amount of open source code.</p>
<p>Stepping back slightly, if you look at open source then there are three types: product-based (think open-core), corporate/individual sponsored,  and community-driven.</p></div><a href="/blog/2015/05/06/puppet-community/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2015/03/05/the-dns-abc/"><h2 class="post-title">The DNS ABC</h2></a><p class="post-meta">Posted on 5 March 2015 · <a href="/blog/categories/Engineering/" class="tag post-meta">Engineering</a> · <a href="/blog/categories/Theory/" class="tag post-meta">Theory</a> · <a href="/blog/categories/DNS/" class="tag post-meta">DNS</a></p><div class="post-entry"><h2 id="Introduction-to-DNS"><a href="#Introduction-to-DNS" class="headerlink" title="Introduction to DNS"></a>Introduction to DNS</h2><p>Before joining OpenTable I was looking for a software engineer job and I’ve done my fair share of interviews. A question that has popped out a lot, and when I say a lot I mean <em>always</em>, is:</p>
<p><em>Could you tell me what happens when I type an URL in a web browser on my computer and press enter?</em></p>
<p>Of course the possible answers could range from “MMMHHH, wellll, I’m not sure where to start…” to a whole book on computer networks.</p>
<p>After a number of attempts to answer briefly and correctly, I’ve concluded that mentioning <strong>DNS</strong> can make a reasonable start.</p>
<p>Let’s think about it. When we type the address of the resource we want to browse, we use the alphabet, right? With letters and names easily readable and retainable by a human being.</p>
<p>But a machine needs an <strong>IP address</strong> to recognize another machine connected to a network. An IP address is numerical, for example 192.168.0.1. Less readable, it seems.</p>
<p>And here is where DNS comes to play. DNS stands for <strong>Domain Name System</strong>, and that represents exactly what it is: a system that translates <strong>domain names</strong> (e.g <em><a href="http://www.opentable.co.uk" target="_blank" rel="noopener">www.opentable.co.uk</a></em>), into IP addresses. I think of it as a phone book. It is queried with a domain name and, after a lookup, returns an IP.</p>
<p>How does the magic happen? Let’s look into it.</p>
<h2 id="The-ABC"><a href="#The-ABC" class="headerlink" title="The ABC"></a>The ABC</h2></div><a href="/blog/2015/03/05/the-dns-abc/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2015/02/16/hapi-js-and-sigterm/"><h2 class="post-title">Hapi.js and SIGTERM</h2></a><p class="post-meta">Posted on 16 February 2015 · <a href="/blog/categories/Microservices/" class="tag post-meta">Microservices</a> · <a href="/blog/categories/Hapi-js/" class="tag post-meta">Hapi.js</a> · <a href="/blog/categories/SIGTERM/" class="tag post-meta">SIGTERM</a></p><div class="post-entry"><p>When we first stood up our hapi.js APIs, we wrote init scripts to start/stop them. Stopping the server, was simply a case of sending SIGKILL (causing the app to immediately exit).</p>
<p>Whilst this is fine for most cases, if we want our apps to be good Linux citizens, then they should terminate gracefully. Hapi.js has the handy <code>server.stop(...)</code> command (see docs <a href="http://hapijs.com/api#serverstopoptions-callback" target="_blank" rel="noopener">here</a>) which will terminate the server gracefully. It will cause the server to respond to new connections with a 503 (server unavailable), and wait for existing connections to terminate (up to some specified timeout), before stopping the server and allowing the node.js process to exit. Perfect.</p>
<p>This makes our graceful shutdown code really simple:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">process.on(<span class="string">'SIGTERM'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  server.stop(&#123; <span class="attr">timeout</span>: <span class="number">5</span> * <span class="number">1000</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    process.exit(<span class="number">0</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>When we see a SIGTERM, call <code>server.stop()</code>, then once the server has stopped, call <code>process.exit(0)</code>. Easy peasy.</p>
<h3 id="Throw-a-spanner-in-the-works"><a href="#Throw-a-spanner-in-the-works" class="headerlink" title="Throw a spanner in the works"></a>Throw a spanner in the works</h3><p>Whilst <code>server.stop()</code> is really useful, it has the problem that it immediately prevents the server from responding to new requests. In our case, that isn’t particularly desirable. We use service-discovery, which means that the graceful termination of our app should run like this:</p>
<ul>
<li>SIGTERM</li>
<li>Unannounce from Service-Discovery</li>
<li><code>server.stop(...)</code></li>
<li><code>process.exit(0)</code></li>
</ul>
<p>Ideally we want the unannounce to happen before the server starts rejecting connections, in order to reduce the likelihood that clients will hit a server that is shutting down.</p>
<h3 id="Plugins-to-the-rescue"><a href="#Plugins-to-the-rescue" class="headerlink" title="Plugins to the rescue!"></a>Plugins to the rescue!</h3></div><a href="/blog/2015/02/16/hapi-js-and-sigterm/" class="post-read-more">[Read More]</a></article></div><ul class="pager main-pager"><li class="previous"><a href="/page/3">← Newer Posts</a></li><li class="next"><a href="/page/5">Older Posts →</a></li></ul></div></div></div><footer><div class="container beautiful-jekyll-footer"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href="https://github.com/opentable" title="GitHub"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-github"></i></span></a></li><li><a href="https://twitter.com/opentabletechuk" title="Twitter"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-twitter"></i></span></a></li><li><a href="https://www.linkedin.com/company/12181" title="LinkedIn"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-linkedin"></i></span></a></li><li><a href="http://stackoverflow.com/jobs/companies/opentable" title="StackOverflow"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-stack-overflow"></i></span></a></li></ul><p class="copyright text-muted">© OpenTable • 2019 • <a href="mailto:undefined"></a>
</p><p class="theme-by text-muted">Theme by
<a href="https://github.com/twoyao/beautiful-hexo">beautiful-hexo</a></p></div></div></div></footer><script src="/js/jquery-1.11.2.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/main.js"></script><script src="/js/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
    a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-2621903-16', 'auto');
ga('send', 'pageview');</script></body></html>