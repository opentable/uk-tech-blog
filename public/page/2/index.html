<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><meta name="author" content="OpenTable"><link rel="icon" href="/favicon.png"><title>OpenTable Tech UK Blog</title><meta name="description"><link rel="alternate" type="application/rss+xml" title="OpenTable Tech UK Blog" href="/atom.xml"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><script src="//fonts.otstatic.com/zys4lfz.js"></script><link rel="stylesheet" href="/css/highlight.css">
</head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class="container-fluid"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#main-navbar" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">OpenTable Tech UK Blog</a></div><div id="main-navbar" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/about/">About</a></li><li><a href="/archives/">Archive</a></li><li><a href="/blog/authors/">Authors</a></li></ul></div><div class="avatar-container"><div class="avatar-img-border"><a href="/"><img src="/opentable.png" class="avatar-img"></a></div></div></div></nav><div id="header-big-imgs" data-num-img='3' data-img-src-1="/bigimgs/building.jpg" data-img-desc-1="Alphabeta Building" data-img-src-2="/bigimgs/kitchen.jpg" data-img-desc-2="OpenTable London office" data-img-src-3="/bigimgs/office.jpg" data-img-desc-3="OpenTable Engineers"></div><header class="header-section has-img"><div class="intro-header big-img"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="page-heading"><h1>OpenTable Tech UK Blog</h1><hr class="small"><span class="page-subheading">The technology blog for OpenTable UK.</span></div></div></div></div><span class="img-desc"></span></div></header><div role="main" class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="posts-list"><article class="post-preview"><a href="/blog/2015/02/16/hapi-js-and-sigterm/"><h2 class="post-title">Hapi.js and SIGTERM</h2></a><p class="post-meta">Posted on 16 February 2015 · <a href="/blog/categories/Microservices/" class="tag post-meta">Microservices</a> · <a href="/blog/categories/Hapi-js/" class="tag post-meta">Hapi.js</a> · <a href="/blog/categories/SIGTERM/" class="tag post-meta">SIGTERM</a></p><div class="post-entry"><p>When we first stood up our hapi.js APIs, we wrote init scripts to start/stop them. Stopping the server, was simply a case of sending SIGKILL (causing the app to immediately exit).</p>
<p>Whilst this is fine for most cases, if we want our apps to be good Linux citizens, then they should terminate gracefully. Hapi.js has the handy <code>server.stop(...)</code> command (see docs <a href="http://hapijs.com/api#serverstopoptions-callback" target="_blank" rel="external">here</a>) which will terminate the server gracefully. It will cause the server to respond to new connections with a 503 (server unavailable), and wait for existing connections to terminate (up to some specified timeout), before stopping the server and allowing the node.js process to exit. Perfect.</p>
<p>This makes our graceful shutdown code really simple:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">process.on(<span class="string">'SIGTERM'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  server.stop(&#123; <span class="attr">timeout</span>: <span class="number">5</span> * <span class="number">1000</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    process.exit(<span class="number">0</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>When we see a SIGTERM, call <code>server.stop()</code>, then once the server has stopped, call <code>process.exit(0)</code>. Easy peasy.</p>
</div><a href="/blog/2015/02/16/hapi-js-and-sigterm/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2015/02/09/dismantling-the-monolith-microsites-at-opentable/"><h2 class="post-title">Dismantling the monolith - Microsites at Opentable</h2></a><p class="post-meta">Posted on 9 February 2015 · <a href="/blog/categories/SOA/" class="tag post-meta">SOA</a> · <a href="/blog/categories/Microsites/" class="tag post-meta">Microsites</a> · <a href="/blog/categories/Microservices/" class="tag post-meta">Microservices</a> · <a href="/blog/categories/Monolith/" class="tag post-meta">Monolith</a> · <a href="/blog/categories/OpenComponents/" class="tag post-meta">OpenComponents</a></p><div class="post-entry"><p>A couple of years ago we started to break-up the code-base behind our consumer site <a href="http://www.opentable.com" target="_blank" rel="external">opentable.com</a>, to smaller units of code, in order to improve our productivity. New teams were created with the goal of splitting up the logic that was powering the back-end and then bring to life new small services. Then, we started working on what we call <em>Microsites</em>.</p>
<h3 id="Microsites"><a href="#Microsites" class="headerlink" title="Microsites"></a>Microsites</h3><p>A microsite is a very small set of web-pages, or even a single one, that takes care of handling a very specific part of the system’s domain logic. Examples are the <em>Search Results</em> page or the <em>Restaurant’s Profile</em> page. Every microsite is an independently deployable unit of code, so it is easier to test, to deploy, and in consequence more resilient. Microsites are then all connected by a front-door service that handles the routing.</p>
<h3 id="Not-a-free-ride"><a href="#Not-a-free-ride" class="headerlink" title="Not a free ride"></a>Not a free ride</h3><p>When we deployed some microsites to production we immediately discovered a lot of pros:</p>
<ul>
<li>Bi-weekly deployments of the monolith became hundreds of deployments every week.</li>
<li>Not anymore a shared codebase for hundreds of engineers. Pull requests accepted, merged, and often deployed on the same day.</li>
<li>Teams experimenting and reiterating faster: product was happy.</li>
<li><em>Diversity</em> on tech stacks: teams were finally able to pick their own favourite web-stack, as soon as they were capable of deploying their code and taking care of it in terms of reliability and performance.</li>
<li>Robustness: when something was wrong with a microsite, everything else was fine.</li>
</ul>
</div><a href="/blog/2015/02/09/dismantling-the-monolith-microsites-at-opentable/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2015/02/02/a-beginners-guide-to-rest-services/"><h2 class="post-title">A Beginner's guide to REST services</h2></a><p class="post-meta">Posted on 2 February 2015 · <a href="/blog/categories/Architecture/" class="tag post-meta">Architecture</a> · <a href="/blog/categories/Engineering/" class="tag post-meta">Engineering</a> · <a href="/blog/categories/REST/" class="tag post-meta">REST</a> · <a href="/blog/categories/API/" class="tag post-meta">API</a> · <a href="/blog/categories/Theory/" class="tag post-meta">Theory</a></p><div class="post-entry"><h2 id="Why-this-post"><a href="#Why-this-post" class="headerlink" title="Why this post?"></a>Why this post?</h2><p>As a junior, I always find it easier to just sit and write code than actually stop to think about the theoretical basis that lie under the applications I work on. <strong>REST</strong>  is one of those terms I heard a lot about, so I decided to try to sum up what it means and how it affects the choices we make everyday as software engineers.</p>
<h2 id="Introduction-to-REST"><a href="#Introduction-to-REST" class="headerlink" title="Introduction to REST"></a>Introduction to REST</h2><p>REST stands for Representational State Transfer, and it can be defined as an architectural style used to build Web Services that are lightweight, maintainable, and scalable. A service that is designed by REST principles can be called a <strong>RESTful service</strong>.</p>
<p>It has been described first in 2000 by Roy Fielding, in a <a href="http://www.ics.uci.edu/~fielding/pubs/webarch_icse2000.pdf" target="_blank" rel="external">dissertation</a> called “Architectural Styles and the Design of Network-based Software Architectures”. The basic idea was to describe the interactions between the components of a distributed system, putting constraints on them and emphasizing the importance of an uniform interface, that is abstracted from the single components.</p>
<p>REST is often applied to the design and development of web services, which is the scenario I’ll try to address in this post.</p>
</div><a href="/blog/2015/02/02/a-beginners-guide-to-rest-services/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2015/01/23/on-strongly-typed-logging/"><h2 class="post-title">On Strongly Typed Logging</h2></a><p class="post-meta">Posted on 23 January 2015 · <a href="/blog/categories/Architecture/" class="tag post-meta">Architecture</a> · <a href="/blog/categories/ElasticSearch/" class="tag post-meta">ElasticSearch</a> · <a href="/blog/categories/Logs/" class="tag post-meta">Logs</a> · <a href="/blog/categories/Kibana/" class="tag post-meta">Kibana</a></p><div class="post-entry"><p>Logging is a crucial element of monitoring highly available systems. It allows not only to find out about errors but also quickly identify their cause. Logs are often used to generate metrics that help business and engineering make informative decisions on future development directions. </p>
<p>At OpenTable we have a central logging infrastructure, that means all logs are stored in the same shared database (ElasticSearch for us). And everybody can access any logs they want without having very specialized knowledge (thanks Kibana!).</p>
<p>ElasticSearch, though living in a NoSQL world, is not actually a schema-free database. Sure, you do not need to provide schema to it but instead ES will infer schema for you from documents you send to it. This is very similar to type inference you can find in many programming languages. You do not need to specify type of field, but if you later on try to assign inappropriate value to it you will get an exception.</p>
<p>This trait of our database goes all the way to the root of our logging system design. Let me explain why I say that we have ‘strongly typed logs’.</p>
<h2 id="In-The-Beginning-There-Was-String"><a href="#In-The-Beginning-There-Was-String" class="headerlink" title="In The Beginning There Was String"></a>In The Beginning There Was String</h2><p>Before centralization we just logged a single message along with its importance. In code it looked something like:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">logger.ERROR(“Kaboom!”)</div></pre></td></tr></table></figure></p></div><a href="/blog/2015/01/23/on-strongly-typed-logging/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2015/01/19/building-a-living-styleguide-at-opentable/"><h2 class="post-title">Building a living styleguide at OpenTable</h2></a><p class="post-meta">Posted on 19 January 2015 · <a href="/blog/categories/UI/" class="tag post-meta">UI</a> · <a href="/blog/categories/Design/" class="tag post-meta">Design</a> · <a href="/blog/categories/OpenTable/" class="tag post-meta">OpenTable</a> · <a href="/blog/categories/CSS/" class="tag post-meta">CSS</a> · <a href="/blog/categories/Styleguide/" class="tag post-meta">Styleguide</a></p><div class="post-entry"><p>If you’re reading this you’ve probably built yourself a website.  A site - large or small - that’s thrown together or crafted over many months.  And if you have, you’ve probably kept all your CSS class names in your head, or at least been able to go straight to the relevant stylesheets to retrieve them.</p>
<p>Well OpenTable is unsurprisingly built by many engineering teams across multiple continents, and was completely redesigned last year.  And as soon as you have more than a handful of people working on your front-end you will quickly find a well-intentioned developer causing one or both of these problems:</p>
<ul>
<li>Well-intentioned developer adds a new submission form but, like the design Philistine he is, his buttons are <span style="font-family:verdana;font-size:18px;color:#E40000;">18px Verdana #E40000</span>, not the correct <span style="font-family:arial;font-size:16px;color:#DA3743;">16px Arial #DA3743</span></li>
<li>Your good old developer knows which font size and colour it should be, but bungs a duplicate class into a random stylesheet (or worse still, inline)</li>
</ul>
<p>Despite these risks, a single front-end dev (or a team of them) cannot check every new piece of code or they will quickly become a bottleneck.</p>
<h3 id="You-need-some-guidelines"><a href="#You-need-some-guidelines" class="headerlink" title="You need some guidelines"></a>You need some guidelines</h3><p>Offline designers regularly create ‘brand guidelines’ or ‘design standards’ to document the precise way their brand or product should be recreated when outside of their control.  Online, such guidelines are similarly invaluable for maintaining brand and code consistency with multiple engineers and designers, but it is blindingly obvious that a printed or ‘static’ set of guidelines is completely unsuitable for a constantly changing website.</p></div><a href="/blog/2015/01/19/building-a-living-styleguide-at-opentable/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2015/01/01/explaining-flux-architecture-with-macgyver-dot-js/"><h2 class="post-title">Explaining Flux architecture with macgyver.js</h2></a><p class="post-meta">Posted on 1 January 2015 · <a href="/blog/categories/JavaScript/" class="tag post-meta">JavaScript</a> · <a href="/blog/categories/Macgyver/" class="tag post-meta">Macgyver</a> · <a href="/blog/categories/Flux/" class="tag post-meta">Flux</a></p><div class="post-entry"><h2 id="What-is-Flux"><a href="#What-is-Flux" class="headerlink" title="What is Flux?"></a>What is Flux?</h2><p><a href="https://github.com/facebook/flux" target="_blank" rel="external">Flux</a> is an application architectural pattern developed by Facebook. It was developed to solve some of the complexities of the MVC pattern when used at scale by favouring a uni-directional approach. It is a pattern and not a technology or framework.</p>
<p><img src="/images/posts/mvc-scale.png" alt="MVC scale issue"></p>
<p>When applications that use the model-view-controller (MVC) pattern at any scale it becomes difficult to maintain consistent data across multiple views. In particular the case whereby flow between models and views is not uni-directional and may require increasing logic to maintain parity between views when model data is updated. Facebook hit this issue several times and in particular with their unseen count (an incremented value of unseen messages which is updated by several UI chat components). It wasn’t until they realised that the MVC pattern accomodated the complexity that they stepped back from the problem and addressed the architecture.</p>
<p>Flux is intentionally unidirectional.</p>
<p><img src="/images/posts/flux.png" alt="flux"></p></div><a href="/blog/2015/01/01/explaining-flux-architecture-with-macgyver-dot-js/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/12/08/supporting-ie8-in-the-opentable-redesign/"><h2 class="post-title">Supporting IE8 in the OpenTable redesign</h2></a><p class="post-meta">Posted on 8 December 2014 · <a href="/blog/categories/Design/" class="tag post-meta">Design</a> · <a href="/blog/categories/OpenTable/" class="tag post-meta">OpenTable</a> · <a href="/blog/categories/CSS/" class="tag post-meta">CSS</a> · <a href="/blog/categories/Grunt/" class="tag post-meta">Grunt</a> · <a href="/blog/categories/Sass/" class="tag post-meta">Sass</a> · <a href="/blog/categories/Internet-Explorer/" class="tag post-meta">Internet Explorer</a></p><div class="post-entry"><p>We’re really <a href="http://blog.opentable.com/2014/opentables-website-re-designed-re-architected-re-imagined/" target="_blank" rel="external">proud to have released</a> last week our redesigned <a href="http://www.opentable.co.uk" target="_blank" rel="external">OpenTable</a> site, the culmination of months of hard work from many talented people here in London and in San Francisco.</p>
<p>However despite killing off our old site and its 2004 design, 2.8% of our visitors could have been crying into their keyboard as a far worse opentable.co.uk filled their screen.</p>
<p>That version of OpenTable was our new responsive site viewed in Internet Explorer 8.</p>
<p><img src="/images/posts/redesign-ie8.png" alt="Our redesign before we optimised for IE8"></p>
<p>The fundamental issue is that IE8 doesn’t support media queries so the age-old browser would try to stretch our <em>mobile-first</em> responsive design as wide as it could go - not great across a 27” Thunderbolt.</p>
</div><a href="/blog/2014/12/08/supporting-ie8-in-the-opentable-redesign/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/11/28/proxying-with-hapi/"><h2 class="post-title">Proxying Services With Hapi.js</h2></a><p class="post-meta">Posted on 28 November 2014 · <a href="/blog/categories/Microservices/" class="tag post-meta">Microservices</a> · <a href="/blog/categories/Hapi-js/" class="tag post-meta">Hapi.js</a> · <a href="/blog/categories/Proxy/" class="tag post-meta">Proxy</a></p><div class="post-entry"><p>I’ve raved in the past about how awesome <a href="http://hapijs.com" target="_blank" rel="external">hapi.js</a> is, but I’m going to talk about just a specific case today.</p>
<p>We started off with just a couple of hapi.js apis. This was at a time when standing up new infrastructure was still a bit painful, so inevitably those apis ended up having more functionality in them than they should have. Now it’s easy for us to get infrastructure, so we want to do more of it.</p>
<p>Our goal is to have lots of small(er) apis that just look after one specific piece (skillfully avoiding using the buzzword ‘microservices’).</p>
<p>When you want to split out functionality from one api to another, it can be a pain, especially if you have a lot of consumers who aren’t particularly fast-moving or communicative. Or maybe you don’t know all your consumers up front.</p>
<p>You’ve got a couple of options here:</p>
</div><a href="/blog/2014/11/28/proxying-with-hapi/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/11/26/hobknob-v2-dot-0-a-new-dimension/"><h2 class="post-title">Hobknob v2.0: A new dimension</h2></a><p class="post-meta">Posted on 26 November 2014 · <a href="/blog/categories/Hobknob/" class="tag post-meta">Hobknob</a></p><div class="post-entry"><p>Sometimes there is the requirement for more granularity when toggling a feature switch.<br>Version 2.0 of <a href="https://github.com/opentable/hobknob" target="_blank" rel="external">Hobknob</a> hopes to address this with feature categories.</p>
<h3 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR."></a>TL;DR.</h3><p>Hobknob now allows you to define categories of features that have multiple toggles per feature.</p>
<p>For example, you can define the ‘Domain Features’ category which allows you to toggle a feature OFF in <code>your-website.com</code>, but ON in <code>your-website.co.uk</code>.</p>
<p><img src="/images/posts/hobknob-domain-features.png" alt="Domain Features"></p>
<h2 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h2></div><a href="/blog/2014/11/26/hobknob-v2-dot-0-a-new-dimension/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/11/08/interacting-with-elasticsearch-using-hubot/"><h2 class="post-title">Interacting with ElasticSearch using Hubot</h2></a><p class="post-meta">Posted on 8 November 2014 · <a href="/blog/categories/Hubot/" class="tag post-meta">Hubot</a> · <a href="/blog/categories/Chatops/" class="tag post-meta">Chatops</a> · <a href="/blog/categories/ElasticSearch/" class="tag post-meta">ElasticSearch</a></p><div class="post-entry"><p>At OpenTable, we use a few <a href="">ElasticSearch</a> clusters. Our aim was to be able to interact with our ElasticSearch clusters via <a href="http://www.hipchat.com" target="_blank" rel="external">HipChat</a> so that we could troubleshoot easily and without having to log into our VPN. We already use <a href="http://hubot.github.com" target="_blank" rel="external">Hubot</a> as part of our systems workflow, so it made sense to be able to interact with ElasticSearch with it. </p>
<h3 id="Setting-a-cluster-alias"><a href="#Setting-a-cluster-alias" class="headerlink" title="Setting a cluster alias"></a>Setting a cluster alias</h3><p>When a pager wakes me at 3am, I really do not want to have to try and type the cluster URL into my mobile hipchat client. So the first thing that was added to the script was the ability to give a cluster an alias.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">elasticsearch add alias my-test-alias http://my-cluster.com:9200</div></pre></td></tr></table></figure>
<p><img src="/images/posts/elasticsearch-add-alias.png" alt="add-alias"></p>
<p>This allows us to use that alias for all commands going forward. Please note that you can remove and query aliases as well:</p></div><a href="/blog/2014/11/08/interacting-with-elasticsearch-using-hubot/" class="post-read-more">[Read More]</a></article></div><ul class="pager main-pager"><li class="previous"><a href="/">← Newer Posts</a></li><li class="next"><a href="/page/3">Older Posts →</a></li></ul></div></div></div><footer><div class="container beautiful-jekyll-footer"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href="https://github.com/opentable" title="GitHub"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-github"></i></span></a></li><li><a href="https://twitter.com/opentabletechuk" title="Twitter"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-twitter"></i></span></a></li><li><a href="https://www.linkedin.com/company/12181" title="LinkedIn"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-linkedin"></i></span></a></li><li><a href="http://stackoverflow.com/jobs/companies/opentable" title="StackOverflow"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-stack-overflow"></i></span></a></li></ul><p class="copyright text-muted">© OpenTable • 2017 • <a href="mailto:undefined"></a>
</p><p class="theme-by text-muted">Theme by
<a href="https://github.com/twoyao/beautiful-hexo">beautiful-hexo</a></p></div></div></div></footer><script src="/js/jquery-1.11.2.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/main.js"></script><script src="/js/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
    a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-2621903-16', 'auto');
ga('send', 'pageview');</script></body></html>