<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><meta name="author" content="OpenTable"><link rel="icon" href="/favicon.png"><title>OpenTable Tech UK Blog</title><meta name="description"><link rel="alternate" type="application/rss+xml" title="OpenTable Tech UK Blog" href="/atom.xml"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><script src="//fonts.otstatic.com/zys4lfz.js"></script><link rel="stylesheet" href="/css/highlight.css">
</head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class="container-fluid"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#main-navbar" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">OpenTable Tech UK Blog</a></div><div id="main-navbar" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/about/">About</a></li><li><a href="/archives/">Archive</a></li><li><a href="/blog/authors/">Authors</a></li></ul></div><div class="avatar-container"><div class="avatar-img-border"><a href="/"><img src="/opentable.png" class="avatar-img"></a></div></div></div></nav><div id="header-big-imgs" data-num-img='3' data-img-src-1="/bigimgs/building.jpg" data-img-desc-1="Alphabeta Building" data-img-src-2="/bigimgs/kitchen.jpg" data-img-desc-2="OpenTable London office" data-img-src-3="/bigimgs/office.jpg" data-img-desc-3="OpenTable Engineers"></div><header class="header-section has-img"><div class="intro-header big-img"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="page-heading"><h1>OpenTable Tech UK Blog</h1><hr class="small"><span class="page-subheading">The technology blog for OpenTable UK.</span></div></div></div></div><span class="img-desc"></span></div></header><div role="main" class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="posts-list"><article class="post-preview"><a href="/blog/2015/03/05/the-dns-abc/"><h2 class="post-title">The DNS ABC</h2></a><p class="post-meta">Posted on 5 March 2015 · <a href="/blog/categories/Engineering/" class="tag post-meta">Engineering</a> · <a href="/blog/categories/Theory/" class="tag post-meta">Theory</a> · <a href="/blog/categories/DNS/" class="tag post-meta">DNS</a></p><div class="post-entry"><h2 id="Introduction-to-DNS"><a href="#Introduction-to-DNS" class="headerlink" title="Introduction to DNS"></a>Introduction to DNS</h2><p>Before joining OpenTable I was looking for a software engineer job and I’ve done my fair share of interviews. A question that has popped out a lot, and when I say a lot I mean <em>always</em>, is:</p>
<p><em>Could you tell me what happens when I type an URL in a web browser on my computer and press enter?</em></p>
<p>Of course the possible answers could range from “MMMHHH, wellll, I’m not sure where to start…” to a whole book on computer networks.</p>
<p>After a number of attempts to answer briefly and correctly, I’ve concluded that mentioning <strong>DNS</strong> can make a reasonable start.</p>
<p>Let’s think about it. When we type the address of the resource we want to browse, we use the alphabet, right? With letters and names easily readable and retainable by a human being.</p>
<p>But a machine needs an <strong>IP address</strong> to recognize another machine connected to a network. An IP address is numerical, for example 192.168.0.1. Less readable, it seems.</p>
<p>And here is where DNS comes to play. DNS stands for <strong>Domain Name System</strong>, and that represents exactly what it is: a system that translates <strong>domain names</strong> (e.g <em>www.opentable.co.uk</em>), into IP addresses. I think of it as a phone book. It is queried with a domain name and, after a lookup, returns an IP.</p>
<p>How does the magic happen? Let’s look into it.</p>
<h2 id="The-ABC"><a href="#The-ABC" class="headerlink" title="The ABC"></a>The ABC</h2></div><a href="/blog/2015/03/05/the-dns-abc/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2015/02/16/hapi-js-and-sigterm/"><h2 class="post-title">Hapi.js and SIGTERM</h2></a><p class="post-meta">Posted on 16 February 2015 · <a href="/blog/categories/Microservices/" class="tag post-meta">Microservices</a> · <a href="/blog/categories/Hapi-js/" class="tag post-meta">Hapi.js</a> · <a href="/blog/categories/SIGTERM/" class="tag post-meta">SIGTERM</a></p><div class="post-entry"><p>When we first stood up our hapi.js APIs, we wrote init scripts to start/stop them. Stopping the server, was simply a case of sending SIGKILL (causing the app to immediately exit).</p>
<p>Whilst this is fine for most cases, if we want our apps to be good Linux citizens, then they should terminate gracefully. Hapi.js has the handy <code>server.stop(...)</code> command (see docs <a href="http://hapijs.com/api#serverstopoptions-callback" target="_blank" rel="external">here</a>) which will terminate the server gracefully. It will cause the server to respond to new connections with a 503 (server unavailable), and wait for existing connections to terminate (up to some specified timeout), before stopping the server and allowing the node.js process to exit. Perfect.</p>
<p>This makes our graceful shutdown code really simple:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">process.on(<span class="string">'SIGTERM'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  server.stop(&#123; <span class="attr">timeout</span>: <span class="number">5</span> * <span class="number">1000</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    process.exit(<span class="number">0</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>When we see a SIGTERM, call <code>server.stop()</code>, then once the server has stopped, call <code>process.exit(0)</code>. Easy peasy.</p>
<h3 id="Throw-a-spanner-in-the-works"><a href="#Throw-a-spanner-in-the-works" class="headerlink" title="Throw a spanner in the works"></a>Throw a spanner in the works</h3><p>Whilst <code>server.stop()</code> is really useful, it has the problem that it immediately prevents the server from responding to new requests. In our case, that isn’t particularly desirable. We use service-discovery, which means that the graceful termination of our app should run like this:</p>
<ul>
<li>SIGTERM</li>
<li>Unannounce from Service-Discovery</li>
<li><code>server.stop(...)</code></li>
<li><code>process.exit(0)</code></li>
</ul>
<p>Ideally we want the unannounce to happen before the server starts rejecting connections, in order to reduce the likelihood that clients will hit a server that is shutting down.</p>
<h3 id="Plugins-to-the-rescue"><a href="#Plugins-to-the-rescue" class="headerlink" title="Plugins to the rescue!"></a>Plugins to the rescue!</h3></div><a href="/blog/2015/02/16/hapi-js-and-sigterm/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2015/02/09/dismantling-the-monolith-microsites-at-opentable/"><h2 class="post-title">Dismantling the monolith - Microsites at Opentable</h2></a><p class="post-meta">Posted on 9 February 2015 · <a href="/blog/categories/SOA/" class="tag post-meta">SOA</a> · <a href="/blog/categories/Microsites/" class="tag post-meta">Microsites</a> · <a href="/blog/categories/Microservices/" class="tag post-meta">Microservices</a> · <a href="/blog/categories/Monolith/" class="tag post-meta">Monolith</a> · <a href="/blog/categories/OpenComponents/" class="tag post-meta">OpenComponents</a></p><div class="post-entry"><p>A couple of years ago we started to break-up the code-base behind our consumer site <a href="http://www.opentable.com" target="_blank" rel="external">opentable.com</a>, to smaller units of code, in order to improve our productivity. New teams were created with the goal of splitting up the logic that was powering the back-end and then bring to life new small services. Then, we started working on what we call <em>Microsites</em>.</p>
<h3 id="Microsites"><a href="#Microsites" class="headerlink" title="Microsites"></a>Microsites</h3><p>A microsite is a very small set of web-pages, or even a single one, that takes care of handling a very specific part of the system’s domain logic. Examples are the <em>Search Results</em> page or the <em>Restaurant’s Profile</em> page. Every microsite is an independently deployable unit of code, so it is easier to test, to deploy, and in consequence more resilient. Microsites are then all connected by a front-door service that handles the routing.</p>
<h3 id="Not-a-free-ride"><a href="#Not-a-free-ride" class="headerlink" title="Not a free ride"></a>Not a free ride</h3><p>When we deployed some microsites to production we immediately discovered a lot of pros:</p>
<ul>
<li>Bi-weekly deployments of the monolith became hundreds of deployments every week.</li>
<li>Not anymore a shared codebase for hundreds of engineers. Pull requests accepted, merged, and often deployed on the same day.</li>
<li>Teams experimenting and reiterating faster: product was happy.</li>
<li><em>Diversity</em> on tech stacks: teams were finally able to pick their own favourite web-stack, as soon as they were capable of deploying their code and taking care of it in terms of reliability and performance.</li>
<li>Robustness: when something was wrong with a microsite, everything else was fine.</li>
</ul>
<p>On the other hand, we soon realised that we introduced new problems on the system:</p>
<ul>
<li>Duplication: teams started duplicating a lot of code, specifically front-end components such as the header, the footer, etc.</li>
<li>Coordination: when we needed to change something on the header, for example, we were expecting to see the change live in different time frames, resulting in inconsistencies.</li>
<li>Performance: every microsite was hosting its own duplicated css, javascript libraries, and static resources; resulting as a big disadvantage for the end-user in terms of performance.</li>
</ul>
<h3 id="SRS-aka-Site-Resources-Service"><a href="#SRS-aka-Site-Resources-Service" class="headerlink" title="SRS - aka Site Resources Service"></a>SRS - aka Site Resources Service</h3><p>To solve some of these problems we created a REST api to serve html snippets, that soon we started to call <em>components</em>. Main characteristics of the system are:</p></div><a href="/blog/2015/02/09/dismantling-the-monolith-microsites-at-opentable/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2015/02/02/a-beginners-guide-to-rest-services/"><h2 class="post-title">A Beginner's guide to REST services</h2></a><p class="post-meta">Posted on 2 February 2015 · <a href="/blog/categories/Architecture/" class="tag post-meta">Architecture</a> · <a href="/blog/categories/Engineering/" class="tag post-meta">Engineering</a> · <a href="/blog/categories/REST/" class="tag post-meta">REST</a> · <a href="/blog/categories/API/" class="tag post-meta">API</a> · <a href="/blog/categories/Theory/" class="tag post-meta">Theory</a></p><div class="post-entry"><h2 id="Why-this-post"><a href="#Why-this-post" class="headerlink" title="Why this post?"></a>Why this post?</h2><p>As a junior, I always find it easier to just sit and write code than actually stop to think about the theoretical basis that lie under the applications I work on. <strong>REST</strong>  is one of those terms I heard a lot about, so I decided to try to sum up what it means and how it affects the choices we make everyday as software engineers.</p>
<h2 id="Introduction-to-REST"><a href="#Introduction-to-REST" class="headerlink" title="Introduction to REST"></a>Introduction to REST</h2><p>REST stands for Representational State Transfer, and it can be defined as an architectural style used to build Web Services that are lightweight, maintainable, and scalable. A service that is designed by REST principles can be called a <strong>RESTful service</strong>.</p>
<p>It has been described first in 2000 by Roy Fielding, in a <a href="http://www.ics.uci.edu/~fielding/pubs/webarch_icse2000.pdf" target="_blank" rel="external">dissertation</a> called “Architectural Styles and the Design of Network-based Software Architectures”. The basic idea was to describe the interactions between the components of a distributed system, putting constraints on them and emphasizing the importance of an uniform interface, that is abstracted from the single components.</p>
<p>REST is often applied to the design and development of web services, which is the scenario I’ll try to address in this post.</p>
<p>The purpose of a web service can be summed up as follows: it exposes <strong>resources</strong> to a <strong>client</strong> so that it can have access to them (examples of typical resources include pictures, video files, web pages and business data).</p>
<p>Common features of a service that is built in a REST style are:</p>
<ul>
<li>Representations</li>
<li>Messages</li>
<li>URIs</li>
<li>Uniform Interface</li>
<li>Statelessness</li>
<li>Links between resources</li>
<li>Caching</li>
</ul>
<h2 id="Representations-what-are-they"><a href="#Representations-what-are-they" class="headerlink" title="Representations - what are they?"></a>Representations - what are they?</h2></div><a href="/blog/2015/02/02/a-beginners-guide-to-rest-services/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2015/01/23/on-strongly-typed-logging/"><h2 class="post-title">On Strongly Typed Logging</h2></a><p class="post-meta">Posted on 23 January 2015 · <a href="/blog/categories/Architecture/" class="tag post-meta">Architecture</a> · <a href="/blog/categories/ElasticSearch/" class="tag post-meta">ElasticSearch</a> · <a href="/blog/categories/Logs/" class="tag post-meta">Logs</a> · <a href="/blog/categories/Kibana/" class="tag post-meta">Kibana</a></p><div class="post-entry"><p>Logging is a crucial element of monitoring highly available systems. It allows not only to find out about errors but also quickly identify their cause. Logs are often used to generate metrics that help business and engineering make informative decisions on future development directions. </p>
<p>At OpenTable we have a central logging infrastructure, that means all logs are stored in the same shared database (ElasticSearch for us). And everybody can access any logs they want without having very specialized knowledge (thanks Kibana!).</p>
<p>ElasticSearch, though living in a NoSQL world, is not actually a schema-free database. Sure, you do not need to provide schema to it but instead ES will infer schema for you from documents you send to it. This is very similar to type inference you can find in many programming languages. You do not need to specify type of field, but if you later on try to assign inappropriate value to it you will get an exception.</p>
<p>This trait of our database goes all the way to the root of our logging system design. Let me explain why I say that we have ‘strongly typed logs’.</p>
<h2 id="In-The-Beginning-There-Was-String"><a href="#In-The-Beginning-There-Was-String" class="headerlink" title="In The Beginning There Was String"></a>In The Beginning There Was String</h2><p>Before centralization we just logged a single message along with its importance. In code it looked something like:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">logger.ERROR(“Kaboom!”)</div></pre></td></tr></table></figure></p>
<p>which resulted in logline on disk having timestamp, severity and message.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;2014-10-10T07:33:04Z [ERROR] Kaboom!&#125;</div></pre></td></tr></table></figure></p>
<p>That worked pretty well. As time passed we often started making log messages more generic to hold relevant data:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">logger.INFO(string.Format(“Received &#123;0&#125; from &#123;1&#125;. Status: &#123;2&#125;. Took &#123;3&#125;”, httpMethod, sourceIp, statusCode, durationms));</div></pre></td></tr></table></figure></p>
<p>When we decided to centralize logs we moved the same logs from local disk to a central database. Suddenly things that used to live on single server in a file called ‘application.log’ become part of one huge lump of data. Instead of easing access to logs they were really hard to filter, without even speaking about aggregation, or any simple form of operations to find the source of the problem. ElasticSearch is really good at free text searching, but frankly speaking FTS is never as precise as a good filter.</p>
<h2 id="Then-There-Was-Dictionary-Of-Strings"><a href="#Then-There-Was-Dictionary-Of-Strings" class="headerlink" title="Then There Was Dictionary Of Strings"></a>Then There Was Dictionary Of Strings</h2></div><a href="/blog/2015/01/23/on-strongly-typed-logging/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2015/01/19/building-a-living-styleguide-at-opentable/"><h2 class="post-title">Building a living styleguide at OpenTable</h2></a><p class="post-meta">Posted on 19 January 2015 · <a href="/blog/categories/UI/" class="tag post-meta">UI</a> · <a href="/blog/categories/Design/" class="tag post-meta">Design</a> · <a href="/blog/categories/OpenTable/" class="tag post-meta">OpenTable</a> · <a href="/blog/categories/CSS/" class="tag post-meta">CSS</a> · <a href="/blog/categories/Styleguide/" class="tag post-meta">Styleguide</a></p><div class="post-entry"><p>If you’re reading this you’ve probably built yourself a website.  A site - large or small - that’s thrown together or crafted over many months.  And if you have, you’ve probably kept all your CSS class names in your head, or at least been able to go straight to the relevant stylesheets to retrieve them.</p>
<p>Well OpenTable is unsurprisingly built by many engineering teams across multiple continents, and was completely redesigned last year.  And as soon as you have more than a handful of people working on your front-end you will quickly find a well-intentioned developer causing one or both of these problems:</p>
<ul>
<li>Well-intentioned developer adds a new submission form but, like the design Philistine he is, his buttons are <span style="font-family:verdana;font-size:18px;color:#E40000;">18px Verdana #E40000</span>, not the correct <span style="font-family:arial;font-size:16px;color:#DA3743;">16px Arial #DA3743</span></li>
<li>Your good old developer knows which font size and colour it should be, but bungs a duplicate class into a random stylesheet (or worse still, inline)</li>
</ul>
<p>Despite these risks, a single front-end dev (or a team of them) cannot check every new piece of code or they will quickly become a bottleneck.</p>
<h3 id="You-need-some-guidelines"><a href="#You-need-some-guidelines" class="headerlink" title="You need some guidelines"></a>You need some guidelines</h3><p>Offline designers regularly create ‘brand guidelines’ or ‘design standards’ to document the precise way their brand or product should be recreated when outside of their control.  Online, such guidelines are similarly invaluable for maintaining brand and code consistency with multiple engineers and designers, but it is blindingly obvious that a printed or ‘static’ set of guidelines is completely unsuitable for a constantly changing website.</p>
<p>Step forward a ‘living’ styleguide.</p>
<p>A living styleguide gives a visual representation of a site’s UI elements using <strong>the exact same code</strong> as on the website, in most cases via the live CSS.  A living styleguide may also provide reusable CSS and HTML code examples and they are not just for engineers new to the code; I frequently use ours at OpenTable and I wrote the stylesheets in the first place (I can’t be expected to remember everything).</p>
<p>Providing reusable code improves collaboration, consistency and standards, and reduces design and development time - but like most documentation it is essential your guide is always up-to-date and trustworthy.  So if a living styleguide is (theoretically) always up-to-date, how did we build ours?</p>
<h2 id="How-we-built-our-styleguide"><a href="#How-we-built-our-styleguide" class="headerlink" title="How we built our styleguide"></a>How we built our styleguide</h2></div><a href="/blog/2015/01/19/building-a-living-styleguide-at-opentable/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2015/01/01/explaining-flux-architecture-with-macgyver-dot-js/"><h2 class="post-title">Explaining Flux architecture with macgyver.js</h2></a><p class="post-meta">Posted on 1 January 2015 · <a href="/blog/categories/JavaScript/" class="tag post-meta">JavaScript</a> · <a href="/blog/categories/Macgyver/" class="tag post-meta">Macgyver</a> · <a href="/blog/categories/Flux/" class="tag post-meta">Flux</a></p><div class="post-entry"><h2 id="What-is-Flux"><a href="#What-is-Flux" class="headerlink" title="What is Flux?"></a>What is Flux?</h2><p><a href="https://github.com/facebook/flux" target="_blank" rel="external">Flux</a> is an application architectural pattern developed by Facebook. It was developed to solve some of the complexities of the MVC pattern when used at scale by favouring a uni-directional approach. It is a pattern and not a technology or framework.</p>
<p><img src="/images/posts/mvc-scale.png" alt="MVC scale issue"></p>
<p>When applications that use the model-view-controller (MVC) pattern at any scale it becomes difficult to maintain consistent data across multiple views. In particular the case whereby flow between models and views is not uni-directional and may require increasing logic to maintain parity between views when model data is updated. Facebook hit this issue several times and in particular with their unseen count (an incremented value of unseen messages which is updated by several UI chat components). It wasn’t until they realised that the MVC pattern accomodated the complexity that they stepped back from the problem and addressed the architecture.</p>
<p>Flux is intentionally unidirectional.</p>
<p><img src="/images/posts/flux.png" alt="flux"></p>
<p>Key to this architecture is the dispatcher. The dispatcher forms the gatekeeper that all actions must go through. When a view, or views, wish to do something they fire an action which the dispatcher correctly routes via registered callbacks made by the stores. </p>
<p>Stores are responsible for the data and respond to callbacks from the dispatcher. When data is changed they emit change events that views listen to to notify them that data has changed. The view can then respond accordingly (for example to update/rebind).</p>
<p>This will become more obvious when we go through the macgyver.js example.</p>
<h2 id="What-is-macgyver-js"><a href="#What-is-macgyver-js" class="headerlink" title="What is macgyver.js?"></a>What is macgyver.js?</h2></div><a href="/blog/2015/01/01/explaining-flux-architecture-with-macgyver-dot-js/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/12/08/supporting-ie8-in-the-opentable-redesign/"><h2 class="post-title">Supporting IE8 in the OpenTable redesign</h2></a><p class="post-meta">Posted on 8 December 2014 · <a href="/blog/categories/Design/" class="tag post-meta">Design</a> · <a href="/blog/categories/OpenTable/" class="tag post-meta">OpenTable</a> · <a href="/blog/categories/CSS/" class="tag post-meta">CSS</a> · <a href="/blog/categories/Grunt/" class="tag post-meta">Grunt</a> · <a href="/blog/categories/Sass/" class="tag post-meta">Sass</a> · <a href="/blog/categories/Internet-Explorer/" class="tag post-meta">Internet Explorer</a></p><div class="post-entry"><p>We’re really <a href="http://blog.opentable.com/2014/opentables-website-re-designed-re-architected-re-imagined/" target="_blank" rel="external">proud to have released</a> last week our redesigned <a href="http://www.opentable.co.uk" target="_blank" rel="external">OpenTable</a> site, the culmination of months of hard work from many talented people here in London and in San Francisco.</p>
<p>However despite killing off our old site and its 2004 design, 2.8% of our visitors could have been crying into their keyboard as a far worse opentable.co.uk filled their screen.</p>
<p>That version of OpenTable was our new responsive site viewed in Internet Explorer 8.</p>
<p><img src="/images/posts/redesign-ie8.png" alt="Our redesign before we optimised for IE8"></p>
<p>The fundamental issue is that IE8 doesn’t support media queries so the age-old browser would try to stretch our <em>mobile-first</em> responsive design as wide as it could go - not great across a 27” Thunderbolt.</p>
<p>To solve the problem we first tried the <a href="https://github.com/scottjehl/Respond" target="_blank" rel="external">Respond.js</a> polyfill but this didn’t work as we’d hoped.  The main issue appeared to be that because we serve our CSS and JS on a separate sub-domain we fell foul of the browser’s cross-domain security.  We followed the Respond.js instructions to solve this but having no luck we looked for alternatives.</p>
<h2 id="Legacssy"><a href="#Legacssy" class="headerlink" title="Legacssy"></a>Legacssy</h2><p>Further Googling lead us to <a href="https://github.com/robinpokorny/grunt-legacssy" target="_blank" rel="external">Legacssy</a>. With this Grunt task we could create a IE8-only stylesheet and not have to serve extra JS and cross-domain proxy files to all visitors.</p>
<p>Our existing process is to create our core CSS with an <code>app.scss</code> file and <a href="https://github.com/sindresorhus/grunt-sass" target="_blank" rel="external">grunt-sass</a>.  Our additional step was to create an <code>app_ie8.scss</code> file, parse it with <code>grunt-sass</code> like before, but then also run it through Legacssy.</p>
<h3 id="Our-app-scss-file"><a href="#Our-app-scss-file" class="headerlink" title="Our app.scss file"></a>Our app.scss file</h3></div><a href="/blog/2014/12/08/supporting-ie8-in-the-opentable-redesign/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/11/28/proxying-with-hapi/"><h2 class="post-title">Proxying Services With Hapi.js</h2></a><p class="post-meta">Posted on 28 November 2014 · <a href="/blog/categories/Microservices/" class="tag post-meta">Microservices</a> · <a href="/blog/categories/Hapi-js/" class="tag post-meta">Hapi.js</a> · <a href="/blog/categories/Proxy/" class="tag post-meta">Proxy</a></p><div class="post-entry"><p>I’ve raved in the past about how awesome <a href="http://hapijs.com" target="_blank" rel="external">hapi.js</a> is, but I’m going to talk about just a specific case today.</p>
<p>We started off with just a couple of hapi.js apis. This was at a time when standing up new infrastructure was still a bit painful, so inevitably those apis ended up having more functionality in them than they should have. Now it’s easy for us to get infrastructure, so we want to do more of it.</p>
<p>Our goal is to have lots of small(er) apis that just look after one specific piece (skillfully avoiding using the buzzword ‘microservices’).</p>
<p>When you want to split out functionality from one api to another, it can be a pain, especially if you have a lot of consumers who aren’t particularly fast-moving or communicative. Or maybe you don’t know all your consumers up front.</p>
<p>You’ve got a couple of options here:</p>
<ul>
<li><p>Maintain the functionality in two places and slowly migrate consumers across</p>
</li>
<li><p>Use a proxy or routing layer in-front of the api to rewrite or redirect requests</p>
</li>
<li><p>Write code in your api to proxy requests to a different server</p>
</li>
</ul>
<p>The first two options are pretty icky, and frankly the third isn’t all that great either. It all depends on you having the right framework. Do you see where I’m going here?</p>
<h3 id="Enter-Hapi-js"><a href="#Enter-Hapi-js" class="headerlink" title="Enter Hapi.js"></a>Enter Hapi.js</h3><p>Hapi.js has the concept of a ‘proxy’ handler, which can transparently proxy requests to a different server.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">server.route([</div><div class="line">  &#123;</div><div class="line">    <span class="attr">method</span>: <span class="string">'GET'</span>,</div><div class="line">    <span class="attr">path</span>: <span class="string">'/foo'</span>,</div><div class="line">    <span class="attr">handler</span>: &#123;</div><div class="line">      <span class="attr">proxy</span>: &#123;</div><div class="line">        <span class="attr">host</span>: <span class="string">'my-other-service.mydomain.com'</span>,</div><div class="line">        <span class="attr">port</span>: <span class="number">80</span>,</div><div class="line">        <span class="attr">protocol</span>: <span class="string">'http'</span>,</div><div class="line">        <span class="attr">passThrough</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">xforward</span>: <span class="literal">true</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">]);</div></pre></td></tr></table></figure></div><a href="/blog/2014/11/28/proxying-with-hapi/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2014/11/26/hobknob-v2-dot-0-a-new-dimension/"><h2 class="post-title">Hobknob v2.0: A new dimension</h2></a><p class="post-meta">Posted on 26 November 2014 · <a href="/blog/categories/Hobknob/" class="tag post-meta">Hobknob</a></p><div class="post-entry"><p>Sometimes there is the requirement for more granularity when toggling a feature switch.<br>Version 2.0 of <a href="https://github.com/opentable/hobknob" target="_blank" rel="external">Hobknob</a> hopes to address this with feature categories.</p>
<h3 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR."></a>TL;DR.</h3><p>Hobknob now allows you to define categories of features that have multiple toggles per feature.</p>
<p>For example, you can define the ‘Domain Features’ category which allows you to toggle a feature OFF in <code>your-website.com</code>, but ON in <code>your-website.co.uk</code>.</p>
<p><img src="/images/posts/hobknob-domain-features.png" alt="Domain Features"></p>
<h2 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h2><p>Feature categories are configured with a few pieces of information. For example:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"categories"</span>: [</div><div class="line">    &#123;</div><div class="line">      <span class="attr">"id"</span>: <span class="number">0</span>,</div><div class="line">      <span class="attr">"name"</span>: <span class="string">"Simple Features"</span>,</div><div class="line">      <span class="attr">"description"</span>: <span class="string">"Use when you want your feature to be either on or off"</span></div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      <span class="attr">"id"</span>: <span class="number">1</span>,</div><div class="line">      <span class="attr">"name"</span>: <span class="string">"Domain Features"</span>,</div><div class="line">      <span class="attr">"description"</span>: <span class="string">"Use when you want your features to be toggled separately for different domains"</span>,</div><div class="line">      <span class="attr">"values"</span>: [<span class="string">"com"</span>, <span class="string">"couk"</span>, <span class="string">"de"</span>, <span class="string">"commx"</span>, <span class="string">"jp"</span>, <span class="string">"ca"</span>]</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      <span class="attr">"id"</span>: <span class="number">2</span>,</div><div class="line">      <span class="attr">"name"</span>: <span class="string">"Locale Features"</span>,</div><div class="line">      <span class="attr">"description"</span>: <span class="string">"Use when you want your features to be toggled separately for different locales"</span>,</div><div class="line">      <span class="attr">"values"</span>: [<span class="string">"en-GB"</span>, <span class="string">"en-US"</span>, <span class="string">"fr-CA"</span>, <span class="string">"de-DE"</span>, <span class="string">"ja-JP"</span>, <span class="string">"es-MX"</span>]</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Notice that each category (except the simple feature category) provides an array of accepted toggle values.</p>
<p>All non-simple feature toggles will have the key <code>application-name/feature-name/toggle-name</code>.<br>For example, <code>main-website/show-user-section/com</code>.</p></div><a href="/blog/2014/11/26/hobknob-v2-dot-0-a-new-dimension/" class="post-read-more">[Read More]</a></article></div><ul class="pager main-pager"><li class="previous"><a href="/">← Newer Posts</a></li><li class="next"><a href="/page/3">Older Posts →</a></li></ul></div></div></div><footer><div class="container beautiful-jekyll-footer"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href="https://github.com/opentable" title="GitHub"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-github"></i></span></a></li><li><a href="https://twitter.com/opentabletechuk" title="Twitter"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-twitter"></i></span></a></li><li><a href="https://www.linkedin.com/company/12181" title="LinkedIn"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-linkedin"></i></span></a></li><li><a href="http://stackoverflow.com/jobs/companies/opentable" title="StackOverflow"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-stack-overflow"></i></span></a></li></ul><p class="copyright text-muted">© OpenTable • 2017 • <a href="mailto:undefined"></a>
</p><p class="theme-by text-muted">Theme by
<a href="https://github.com/twoyao/beautiful-hexo">beautiful-hexo</a></p></div></div></div></footer><script src="/js/jquery-1.11.2.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/main.js"></script><script src="/js/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
    a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-2621903-16', 'auto');
ga('send', 'pageview');</script></body></html>