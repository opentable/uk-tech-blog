<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><meta name="author" content="OpenTable"><link rel="icon" href="/favicon.png"><title>OpenTable Tech UK Blog</title><meta name="description"><link rel="alternate" type="application/rss+xml" title="OpenTable Tech UK Blog" href="/atom.xml"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><script src="//fonts.otstatic.com/zys4lfz.js"></script><link rel="stylesheet" href="/css/highlight.css">
</head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class="container-fluid"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#main-navbar" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">OpenTable Tech UK Blog</a></div><div id="main-navbar" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/about/">About</a></li><li><a href="/archives/">Archive</a></li><li><a href="/blog/authors/">Authors</a></li></ul></div><div class="avatar-container"><div class="avatar-img-border"><a href="/"><img src="/opentable.png" class="avatar-img"></a></div></div></div></nav><div id="header-big-imgs" data-num-img='3' data-img-src-1="/bigimgs/building.jpg" data-img-desc-1="Alphabeta Building" data-img-src-2="/bigimgs/kitchen.jpg" data-img-desc-2="OpenTable London office" data-img-src-3="/bigimgs/office.jpg" data-img-desc-3="OpenTable Engineers"></div><header class="header-section has-img"><div class="intro-header big-img"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="page-heading"><h1>OpenTable Tech UK Blog</h1><hr class="small"><span class="page-subheading">The technology blog for OpenTable UK.</span></div></div></div></div><span class="img-desc"></span></div></header><div role="main" class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="posts-list"><article class="post-preview"><a href="/blog/2019/06/11/meetup-design-systems-in-the-real-world-with-react/"><h2 class="post-title">Meetup: Design Systems in the Real World with React</h2></a><p class="post-meta">Posted on 11 June 2019 · <a href="/blog/categories/Culture/" class="tag post-meta">Culture</a> · <a href="/blog/categories/Meetup/" class="tag post-meta">Meetup</a></p><div class="post-entry"></div><a href="/blog/2019/06/11/meetup-design-systems-in-the-real-world-with-react/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2019/02/26/structuring-large-asp-net-projects-for-testing-and-readability/"><h2 class="post-title">Structuring large ASP.NET Core projects for testing and readability</h2></a><p class="post-meta">Posted on 26 February 2019 · <a href="/blog/categories/Testing/" class="tag post-meta">Testing</a> · <a href="/blog/categories/DotNetCore/" class="tag post-meta">DotNetCore</a> · <a href="/blog/categories/ASP-Net/" class="tag post-meta">ASP.Net</a> · <a href="/blog/categories/NUnit/" class="tag post-meta">NUnit</a></p><div class="post-entry"><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>This is a continuation of the post <a href="/blog/2019/01/28/testing-an-api-in-memory-in-asp-net-core/">Testing an API In Memory in ASP.NET Core</a> where I described in detail how to test an ASP.NET Core API end-to-end in an isolated, repeatable fashion. This is a shorter post that discusses an approach to structuring your project that should make it easier to test and develop.</p>
<p>Oh and there are lots of code samples again!</p>
<h2 id="Where-we-left-off"><a href="#Where-we-left-off" class="headerlink" title="Where we left off"></a>Where we left off</h2><p>In my previous post I described how to get a truly isolated in-memory instance of a ASP.NET Core API configured in a test harness to perform repeatable tests. We created an InMemoryStartup class (for configuring the site for testing) and an InMemoryApi class (for encapsulating Test Doubles and setting up the API). I did not go into detail about the content of either of the Start up classes which is what I intend to address here.</p>
<p>Much of the complexity from this kind of testing derives from having to maintain two configuration classes and keeping them in sync correctly. It is all too easy for strange bugs to creep in and go unnoticed when differences are not correctly replicated. </p>
<p>The solution to this is actually quite straightforward which is to create shared configuration classes that can be specialised for your in-memory testing situation. My solution involves creating two configuration classes, one for each of the two methods that are implemented by convention in your regular Startup.cs and the two methods of the IStartup interface. These are:</p>
<ul>
<li>WebAppConfigurator - for the Configure method of Startup</li>
<li>ServiceCollectionInstallerRunner - for the ConfigureServices method of Startup</li>
</ul>
<p>Both of these classes will have in-memory versions of themselves implemented as extension classes - we will come on to this later. </p>
<h2 id="WebAppConfigurator"><a href="#WebAppConfigurator" class="headerlink" title="WebAppConfigurator"></a>WebAppConfigurator</h2></div><a href="/blog/2019/02/26/structuring-large-asp-net-projects-for-testing-and-readability/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2019/01/28/testing-an-api-in-memory-in-asp-net-core/"><h2 class="post-title">Testing an API In Memory in ASP.NET Core</h2></a><p class="post-meta">Posted on 28 January 2019 · <a href="/blog/categories/Testing/" class="tag post-meta">Testing</a> · <a href="/blog/categories/DotNetCore/" class="tag post-meta">DotNetCore</a> · <a href="/blog/categories/ASP-Net/" class="tag post-meta">ASP.Net</a> · <a href="/blog/categories/NUnit/" class="tag post-meta">NUnit</a></p><div class="post-entry"><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>This is long post that describes how to setup an in-memory test harness for testing an entire ASP.NET Core API with lots of code examples. </p>
<h2 id="Testing-and-broccoli"><a href="#Testing-and-broccoli" class="headerlink" title="Testing and broccoli"></a>Testing and broccoli</h2><p>Unit testing, like broccoli, is something we all know we should do, but actually we just want to tuck into the meat and potatoes of production code. One reason you might resist writing unit tests is that you are writing an API which is mostly a CRUD layer over a database (where most of the code is right-to-left copying from a DTO to an API response), or you are writing framework plugins for which you just can’t write meaningful tests (for instance ActionFilters or Binder). </p>
<p>Well I understand, I’ve been in the same situation, but I have a way of dealing with this problem. What I prefer to do is test at the level of http all the way through the API to the database. But wait, you may cry, that’s not a unit test! Well yes you have a point there, I’m touching lots of different classes when I test like this. I would argue however that the word “unit” is a bit ambiguous; my definition of unit is not ‘a single class’. </p>
<p>I prefer to classify tests as either <strong>Isolated</strong>, <strong>Integration</strong>, or <strong>End-to-End</strong>. When I say isolated, what I mean is that the test can be run without worrying about external dependencies, whether they are your databases or an external API or other system. This means you can test anything from a single class up to the whole API, reliably and repeatably. Integration tests then focus on integrations with your database, external APIs etc. These tests are simple and limited in scope so when they break your integration code is broken or the system is down. End-to-End tests end up being more akin to smoke tests or sanity tests and any break in these should be reflected in your Isolated and Integration tests. </p>
<p>Given these definitions let’s look at how you can test your API end-to-end in an isolated fashion. Or put another way, let’s cook that broccoli in butter and chilli and season with salt, pepper and a little grated parmesan (you’re welcome!)</p>
<p>In order to test an ASP.NET Core application we need to be able to spin up our whole application in a test harness (i.e. your unit test/test fixture). Microsoft provide a NuGet package that lets us do just that; <a href="https://www.nuget.org/packages/Microsoft.AspNetCore.TestHost/" target="_blank" rel="noopener">Microsoft.AspNetCore.TestHost</a> contains a class called TestServer. Once you create an instance of the TestServer you can get an instance of a HttpClient with which you can then make http calls to your API. </p>
<h2 id="Creating-a-TestServer-instance"><a href="#Creating-a-TestServer-instance" class="headerlink" title="Creating a TestServer instance"></a>Creating a TestServer instance</h2><p>To create an instance of the TestServer you need to supply its constructor with an instance of a WebHostBuilder. The easiest way to create a WebHostBuilder is in the same manner as you would when you are building your IWebHost implementation to run your site with Kestrel.</p></div><a href="/blog/2019/01/28/testing-an-api-in-memory-in-asp-net-core/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2018/10/08/starting-your-career-as-a-software-developer/"><h2 class="post-title">Starting your career as a software developer</h2></a><p class="post-meta">Posted on 8 October 2018 · <a href="/blog/categories/OpenTable/" class="tag post-meta">OpenTable</a> · <a href="/blog/categories/Coaching/" class="tag post-meta">Coaching</a> · <a href="/blog/categories/Culture/" class="tag post-meta">Culture</a> · <a href="/blog/categories/Career-progression/" class="tag post-meta">Career progression</a></p><div class="post-entry"><p>A couple of years ago I was asked to give a talk to programming undergraduates at Kings College, London. I wrote up the session as a blog post and added it to my personal website, where it has received <del>thousands</del> one or two hits since.</p>
<p>Reading it back this week I was pleasantly surprised how relevant and useful it still is, and as <a href="http://bit.ly/2IZpIRr" target="_blank" rel="noopener">we are currently hiring engineers</a> at the start of their career it is worth resharing here. </p>
<h2 id="Getting-that-first-job"><a href="#Getting-that-first-job" class="headerlink" title="Getting that first job"></a>Getting that first job</h2><p>Whilst I can still remember the interview for my first job, I have greater insight these days from interviewing developers, and I have personally recruited, managed and mentored a number of junior engineers at the beginning of their careers. The next sections talk about our hiring process at OpenTable and within this framework here’s how you’d get us to give you a job.</p>
<h3 id="The-CV"><a href="#The-CV" class="headerlink" title="The CV"></a>The CV</h3><p>The CV is not as crucial as you might think. Get the basics right – no typos and a neat layout – but don’t cram it full of everything you’ve ever done, just enough to whet our appetite. A single page is usually best (no more than two).</p>
<p>The most important thing for a job as a developer is to show that you love writing code. Nothing conveys this passion better than sites/plugins/projects/online courses that you have worked on, particularly outside of your employment. Even better, provide links to repositories, websites, blogs or Q&amp;A sites to show your work and genuine interest.</p>
<p>Dare I say it, but your exams results do not really matter to us. Passion, backed up with examples of work will grab our attention, with that hard-earned first or 2:1 counting only as a tie-breaker.</p>
<h3 id="The-code-test"><a href="#The-code-test" class="headerlink" title="The code test"></a>The code test</h3><p>If we like your CV we’ll ring you for a quick chat, and then ask you to complete a test - either at our office or in your own time. The coding test will vary from role-to-role but will need skills that will be required in the job. If you can’t do the test at all then this isn’t the right role for you, but if you can do part of it then give it a go as it will give us things to talk about in the next stage of the interview.</p></div><a href="/blog/2018/10/08/starting-your-career-as-a-software-developer/" class="post-read-more">[Read More]</a></article><article class="post-preview"><a href="/blog/2018/05/10/monads-explained-by-a-imperative-programmer/"><h2 class="post-title">Monads explained by a imperative programmer - with examples</h2></a><p class="post-meta">Posted on 10 May 2018 · <a href="/blog/categories/Monads/" class="tag post-meta">Monads</a> · <a href="/blog/categories/Functional-programming/" class="tag post-meta">Functional programming</a> · <a href="/blog/categories/Design-patterns/" class="tag post-meta">Design patterns</a></p><div class="post-entry"><p>A monad is any type construct that follows a specific pattern; it works in the same way as other design patterns. The .NET <code>ApplicationContext</code> is a <code>singleton</code> in the same way that <code>Array</code> is a <code>Monad</code>. Something being a monad does not define its purpose; in the same way that a <code>class</code> can implement many interfaces, a monadic type can also conform to many patterns to increase its usefulness.</p>
<p>Monads are hard to get our heads around because they are very generic. They are defined by having two methods: the <code>bind</code> method (also commonly called <code>fmap</code>), and the <code>unit</code> method (also commonly known as <code>pure</code> or <code>from</code>).</p>
<h2 id="A-bind-fmap-method"><a href="#A-bind-fmap-method" class="headerlink" title="A bind/fmap method."></a>A <code>bind</code>/<code>fmap</code> method.</h2><p>The fmap method follows this signature:<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Given a monadic type TMonad with value type V1,</span></span><br><span class="line"><span class="comment">// and a method that takes a value of type V1 and </span></span><br><span class="line"><span class="comment">// returns the same monadic type TMonad but with </span></span><br><span class="line"><span class="comment">// a value type of V2, produce a monadic type </span></span><br><span class="line"><span class="comment">// TMonad with value V2.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">TMonad&lt;V1&gt; m, Func&lt;V1, TMonad&lt;V2&gt;&gt; f</span>) =&gt; <span class="title">TMonad</span>&lt;<span class="title">V2</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>A quick breakdown of the method signature in plain english: <em>given a monadic type <code>TMonad</code> with value type <code>V1</code>, followed by a method that takes a value of type <code>V1</code> and returns the <strong>same</strong> monadic type <code>TMonad</code> but with a value type of <code>V2</code>, produce a monadic type <code>TMonad</code> with value <code>V2</code>.</em></p>
<p>From the signature, it appears that we should give the value V1 from the first monad to the function <code>f</code> and simply return the TMonad from that call. The ability to control the usage of that function and the ability to intercept the return value is where it gets interesting.</p>
<p>The resulting monad will usually be a composition of the original monad, and the new monad produced by <code>f</code>. That means the “state” held by the two monads are <code>merged</code> and the specifics of how is up to the developer.</p>
<p><em>The monadic type <code>TMonad</code> cannot change after a call to <code>f</code>; a <code>Maybe</code> monad cannot change to a <code>State</code> monad, but this also means that a <code>Maybe</code> monad can never read the value of a <code>State</code> monad by being bound to it. This is something I understood later when I started to question how to use different monads together.</em></p>
<p><em>The value type <code>V1</code> is free to change as a result of calling <code>f</code>. This is why we denote the final result as <code>TMonad&lt;V2&gt;</code>; this doesn’t prevent the value staying the same, in the same way that in a program, <code>x</code> can equal <code>1</code> and <code>y</code> can also equal <code>1</code>, <code>V1</code> could represent a <code>boolean</code> and <code>V2</code> could also represent a <code>boolean</code>.</em></p>
<h2 id="A-unit-pure-from-method"><a href="#A-unit-pure-from-method" class="headerlink" title="A unit/pure/from method"></a>A <code>unit</code>/<code>pure</code>/<code>from</code> method</h2></div><a href="/blog/2018/05/10/monads-explained-by-a-imperative-programmer/" class="post-read-more">[Read More]</a></article></div><ul class="pager main-pager"><li class="next"><a href="/page/2">Older Posts →</a></li></ul></div></div></div><footer><div class="container beautiful-jekyll-footer"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href="https://github.com/opentable" title="GitHub"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-github"></i></span></a></li><li><a href="https://twitter.com/opentabletechuk" title="Twitter"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-twitter"></i></span></a></li><li><a href="https://www.linkedin.com/company/12181" title="LinkedIn"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-linkedin"></i></span></a></li><li><a href="http://stackoverflow.com/jobs/companies/opentable" title="StackOverflow"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-stack-overflow"></i></span></a></li></ul><p class="copyright text-muted">© OpenTable • 2019 • <a href="mailto:undefined"></a>
</p><p class="theme-by text-muted">Theme by
<a href="https://github.com/twoyao/beautiful-hexo">beautiful-hexo</a></p></div></div></div></footer><script src="/js/jquery-1.11.2.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/main.js"></script><script src="/js/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
    a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-2621903-16', 'auto');
ga('send', 'pageview');</script></body></html>